<!DOCTYPE html>
<html lang="en">
  <meta charset="UTF-8" />
  <title>Demo page</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <link rel="stylesheet" href="tnl.css" />
  <body>
    <div class="layout">
      <div class="testata">
        <header></header>
        <div class="sub-header"></div>
      </div>
      <div class="product-container">
        <div class="product-scroll">
          <div class="tags-dropdown">
            <select id="tags-select" onchange="filterProducts()">
              <option value="">#All-Tags</option>
              <option value="vestiti">#vestiti</option>
              <option value="musica">#musica</option>
              <option value="elettronica">#elettronica</option>
              <option value="mobili">#mobili</option>
              <option value="viaggiare">#viaggiare</option>
              <option value="soundsystem">#soundsystem</option>
              <!-- Aggiungi qui gli altri tag -->
            </select>
          </div>
          <div class="product">
            <img
              src="https://ipfs.io/ipfs/QmVtvHzsdXbsKCaXGP7WkUj9b5XYDdg5K4LWjhyaZa4Jyx?filename=graffiti-chair.jpg"
              alt=""
            />
            <div class="description-container">
              <div class="details" data-tags="mobili">
                #comodissima #poco-usata #1970 #ottime-rifiniture
              </div>
              <div class="title">Sedia Vintage</div>
              <div class="description">
                Vendo causa trasloco sedia Vintage super ricercata, usata
                pochissimo. Paglia non rovinata, puzza un pò perchè era in
                cantina, c'è un po di umidità. Spedizione esclusa.
              </div>
            </div>
          </div>
          <div class="product">
            <img
              src="https://ipfs.io/ipfs/QmaHmnyKGenoP3HtY37hfCxzS6awqMzAjGtAv5HTx3jdvS?filename=Group-1601.jpg"
              alt=""
            />
            <div class="description-container">
              <div class="details" data-tags="mobili">
                #bellisma #molto-vecchi #1901 #ottimo-quadretto
              </div>
              <div class="title">Foto Vintage</div>
              <div class="description">
                Vendo causa trasloco foto Vintage super ricercata, usata
                pochissimo. Non rovinata, molto interessante, puzza un pò perchè
                era in cantina, c'è un po di umidità. Spedizione esclusa.
              </div>
            </div>
          </div>
          <div class="product">
            <img
              src="https://ipfs.io/ipfs/QmRiFrbk2FZU1Gd6pE949NkzX5bjeWtrgQKaJHh3xaEeUn?filename=WhatsApp%20Image%202023-07-16%20at%2015.59.25.jpeg"
              alt=""
            />
            <div class="description-container">
              <div class="details" data-tags="elettronica">details.....</div>
              <div class="title">Comandi Game Auto</div>
              <div class="description">description here</div>
            </div>
          </div>
          <div class="product">
            <img src="" alt="" />
            <div class="description-container">
              <div class="details" data-tags="musica">details.....</div>
              <div class="title">title</div>
              <div class="description">description here</div>
            </div>
          </div>
          <div class="product">
            <img src="" alt="" />
            <div class="description-container">
              <div class="details" data-tags="viaggiare">details.....</div>
              <div class="title">title</div>
              <div class="description">description here</div>
            </div>
          </div>
          <div class="product">
            <img src="" alt="" />
            <div class="description-container">
              <div class="details" data-tags="soundsystem">details.....</div>
              <div class="title">title</div>
              <div class="description">description here</div>
            </div>
          </div>
          <div class="product">
            <img src="" alt="" />
            <div class="description-container">
              <div class="details" data-tags="soundsystem">details.....</div>
              <div class="title">title</div>
              <div class="description">description here</div>
            </div>
          </div>
        </div>
      </div>
      <footer class="footer">
        <div class="music-player">
          <audio id="audio-player" controls>
            <source
              src="https://ipfs.io/ipfs/QmVEQavd4Qx31QMRGpWo5bjxFEi27NDs6uWGdNzT27PriR?filename=Gotek%20-%20Tutti%20Fatti.mp3"
              type="audio/mpeg"
              track-title="Gotek%20-%20Tutti%20Fatti"
              track-artist="Gotek"
            />
            <source
              src="https://ipfs.io/ipfs/QmUKNhjXbM2X4h8ZzEq12JFCntKCKYAnk4qfU6NQr2soxG?filename=Hit%20The%20Road%20Jack.mp3"
              type="audio/mpeg"
              track-title="Hit%20The%20Road%20Jack"
              track-artist="Gotek"
            />
            <source
              src="https://ipfs.io/ipfs/QmWXq8zW9XBH8C8VrHQj7zgsd8jUnARqqoE55ytKiKBq8c?filename=Pappa.mp3"
              type="audio/mpeg"
              track-title="Pappa"
              track-artist="Gotek"
            />
            Your browser does not support the audio tag.
          </audio>
          <h2 id="track-title">Titolo della traccia</h2>
          <p id="track-artist">Artista</p>
          <button id="play-pause-button">&#9658;</button>
          <button id="next-button">Next</button>
        </div>
        <button class="group-chat" onclick="showChat()"></button>
      </footer>
    </div>
    <div id="chatsection">
      <div class="close-icon" onclick="closeChat()">&#10006;</div>
      <div class="chat-window" id="chatWindow"></div>
      <div class="input-container">
        <input
          type="text"
          id="messageInput"
          placeholder="Scrivi un messaggio..."
        />
        <button onclick="sendMessage()">Invia</button>
      </div>
    </div>
    div.
  </body>
  <script>
    var chatSection = document.getElementById("chatsection");
    chatSection.style.display = "none";
    function showChat() {
      console.log("ci sono");
      var chatSection = document.getElementById("chatsection");
      chatSection.style.display = "flex";

      var layout = document.getElementsByClassName("layout")[0];
      if (window.innerWidth <= 768) {
        layout.style.filter = "blur(5px)";
      }

      var footer = document.getElementsByClassName("footer")[0];
      footer.style.pointerEvents = "none";
    }
    function closeChat() {
      var chatSection = document.getElementById("chatsection");
      chatSection.style.display = "none";

      var layout = document.getElementsByClassName("layout")[0];
      layout.style.filter = "none";

      var footer = document.getElementsByClassName("footer")[0];
      footer.style.pointerEvents = "auto";
    }

    class RelayMock {
      subscribers = [];
      message;
      messageInput;
      sendToRelay(pubKey, message, signature) {
        this.message = message;
        this.emit();
      }
      emit() {
        this.subscribers.forEach((e) => {
          e(this.message, this.messageInput);
        });
      }
      on(subscriber) {
        this.subscribers.push(subscriber);
      }
    }
    const relay = new RelayMock();
    relay.on(createTextElement);
    function createTextElement(messageText, messageInput) {
      var chatWindow = document.getElementById("chatWindow");
      var messageContainer = document.createElement("div");
      messageContainer.className = "message user-message";
      messageContainer.textContent = messageText;

      chatWindow.insertBefore(messageContainer, chatWindow.firstChild);

      messageInput.value = "";
    }

    function sendMessage() {
      var messageInput = document.getElementById("messageInput");
      var messageText = messageInput.value.trim();
      if (messageText !== "") {
        relay.messageInput = messageInput;
        relay.sendToRelay(undefined, messageText);
      }
    }
    // Aggiunto event listener una volta che la pagina è completamente caricata
    window.addEventListener("load", function () {
      var messageInput = document.getElementById("messageInput");

      // Aggiunta event listener per l'evento keydown
      messageInput.addEventListener("keydown", function (event) {
        // Controllo se il tasto premuto è il tasto Invio (codice 13)
        if (event.keyCode === 13) {
          // Chiamata alla funzione sendMessage() per inviare il messaggio
          sendMessage();
        }
      });
    });
    // MUSIC PLAYER
    const audioPlayer = document.getElementById("audio-player");
    const trackTitle = document.getElementById("track-title");
    const trackArtist = document.getElementById("track-artist");
    const playPauseButton = document.getElementById("play-pause-button");
    const nextButton = document.getElementById("next-button");

    // Aggiungi l'evento click al pulsante play/pausa
    playPauseButton.addEventListener("click", function () {
      if (audioPlayer.paused) {
        audioPlayer.play();
        playPauseButton.innerHTML = "&#10074;&#10074;"; // Simbolo di pausa
      } else {
        audioPlayer.pause();
        playPauseButton.innerHTML = "&#9658;"; // Simbolo di play
      }
    });
    // MENU TENDINA
    function filterProducts() {
      var selectElement = document.getElementById("tags-select");
      var selectedTag = selectElement.value;

      var products = document.getElementsByClassName("product");

      for (var i = 0; i < products.length; i++) {
        var product = products[i];
        var detailsElement = product.querySelector(".details");
        var tags = detailsElement.getAttribute("data-tags");

        if (selectedTag === "" || tags.includes(selectedTag)) {
          product.style.display = "flex";
        } else {
          product.style.display = "none";
        }
      }
    }
    // Aggiungi l'evento click al pulsante successivo
    nextButton.addEventListener("click", function () {
      const currentSource = audioPlayer.currentSrc;
      const sources = audioPlayer.getElementsByTagName("source");
      let nextIndex =
        Array.from(sources).findIndex(
          (source) => source.src === currentSource
        ) + 1;
      if (nextIndex >= sources.length) {
        nextIndex = 0;
      }
      const nextSource = sources[nextIndex];
      audioPlayer.src = nextSource.src;
      trackTitle.textContent = decodeURIComponent(
        nextSource.getAttribute("track-title")
      );
      trackArtist.textContent = decodeURIComponent(
        nextSource.getAttribute("track-artist")
      );
      audioPlayer.play();
      playPauseButton.innerHTML = "&#10074;&#10074;"; // Simbolo di pausa
    });
  </script>
</html>
